# 開発ルール

このドキュメントは、プロジェクトの開発における基本的なルールを定義します。

---

## 目次

1. [テスト駆動開発](#テスト駆動開発)
2. [コーディング規約](#コーディング規約)
3. [コミットルール](#コミットルール)
4. [ドキュメント更新](#ドキュメント更新)

---

## テスト駆動開発

### 基本方針

**「作ったらバグを発生させない」「同じバグを二度と発生させない」**

### 実装時のルール

詳細: [`.agent/rules/testing_implementation_rules.md`](file:///.agent/rules/testing_implementation_rules.md)

**必須事項**:
- ✅ 実装前にテストを書く (TDD)
- ✅ ユニットテスト、統合テスト、E2Eテストの3層すべてを書く
- ✅ テストが通るまでコミットしない
- ✅ カバレッジ80%以上を維持する

**実装フロー**:
```
1. 仕様確認 (5分)
2. テストケース設計 (10分)
3. テスト作成 (30分)
4. 実装 (1時間) - TDDサイクル
5. すべてのテスト実行 (5分)
6. コミット
```

### バグ修正時のルール

詳細: [`.agent/rules/testing_bugfix_rules.md`](file:///.agent/rules/testing_bugfix_rules.md)

**必須事項**:
- ✅ バグを再現するテストを先に書く
- ✅ テストが失敗することを確認する
- ✅ バグを修正してテストが通ることを確認する
- ✅ 関連するテストを追加する
- ✅ ドキュメントを更新する

**バグ修正フロー**:
```
1. バグを再現 (10分)
2. バグ再現テストを書く (20分) - テストは失敗する
3. バグを修正 (30分-1時間) - テストが通る
4. 関連テストを追加 (20分)
5. すべてのテスト実行 (5分)
6. ドキュメント更新 (15分)
7. コミット
```

---

## コーディング規約

### ファイル命名規則

- **コンポーネント**: PascalCase (例: `AssigneeSelector.jsx`)
- **ユーティリティ**: camelCase (例: `formatDate.js`)
- **テスト**: `*.test.jsx` または `*.e2e.spec.js`

### ディレクトリ構造

```
app/
├── src/
│   ├── components/
│   │   └── features/
│   │       └── task/
│   │           ├── SharedComponents.jsx
│   │           ├── SharedComponents.test.jsx       ← ユニットテスト
│   │           └── __tests__/
│   │               └── *.integration.test.jsx      ← 統合テスト
│   └── test/
│       └── setup.js
└── e2e/
    └── *.e2e.spec.js                               ← E2Eテスト
```

### コンポーネント設計

- **単一責任の原則**: 1つのコンポーネントは1つの責任のみ
- **プロップで制御**: 動作はプロップで制御可能にする
- **再利用性**: 他の場所でも使えるように設計する

---

## コミットルール

### コミット前のチェックリスト

- [ ] すべてのテストが通る (`npm run test`)
- [ ] E2Eテストが通る (`npx playwright test`)
- [ ] カバレッジが下がっていない (`npm run test:coverage`)
- [ ] Lintエラーがない
- [ ] ドキュメントを更新した

### コミットメッセージ

```
<type>: <subject>

<body>

<footer>
```

**type**:
- `feat`: 新機能
- `fix`: バグ修正
- `refactor`: リファクタリング
- `test`: テスト追加
- `docs`: ドキュメント更新
- `chore`: その他

**例**:
```
feat: 担当者セレクター実装

- AssigneeSelectorコンポーネントを作成
- ユニットテスト、統合テスト、E2Eテストを追加
- カバレッジ85%

Closes #123
```

---

## ドキュメント更新

### 実装時に更新するドキュメント

1. **コンポーネント仕様書** (`docs/specifications/components/<ComponentName>.md`)
   - 新しいコンポーネントを作成した場合

2. **機能仕様書** (`docs/specifications/features/<FeatureName>.md`)
   - 新しい機能を追加した場合

3. **COMMON_SPEC.md** (`docs/specifications/COMMON_SPEC.md`)
   - 共通の型やインターフェースを変更した場合

### バグ修正時に更新するドキュメント

1. **問題パターンデータベース** (`docs/knowledge/problem_patterns.md`)
   - 新しいバグパターンを追加

2. **コンポーネント仕様書** (`docs/specifications/components/<ComponentName>.md`)
   - 「過去の問題」セクションに追加

3. **バグ調査メソドロジー** (`docs/BUG_INVESTIGATION_METHODOLOGY.md`)
   - 新しい調査手法や知見を追加

---

## まとめ

### 開発の基本フロー

```
新機能実装:
  仕様確認 → テスト作成 → 実装 → テスト実行 → ドキュメント更新 → コミット

バグ修正:
  バグ再現 → テスト作成 → 修正 → テスト実行 → ドキュメント更新 → コミット
```

### 品質保証

- **テスト**: 3層すべてのテストを書く
- **カバレッジ**: 80%以上を維持
- **ドキュメント**: 常に最新に保つ
- **レビュー**: コミット前にセルフレビュー

これらのルールを守ることで、**高品質で保守性の高いコード**を維持できます。
